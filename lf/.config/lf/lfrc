set hidden true
set shell fish
set color256 true
set drawbox true

# Remove some bindings
map f
map m

%{{
    set w (tput cols)
    if [ $w -le 80 ]
        lf -remote "send $id set ratios 1:2"
    else if [ $w -le 160 ]
        lf -remote "send $id set ratios 1:2:3"
    else
        lf -remote "send $id set ratios 1:2:3:5"
    end
}}

cmd open ${{
    set filetype (file --mime-type $f -b -L)
    switch $filetype
        case 'text/*'
            $EDITOR $fx
        case 'application/octet-stream'
            $EDITOR $fx
        case 'application/json'
            $EDITOR $fx
        case '*/pdf'
            setsid -f zathura $fx > /dev/null 2>/dev/null
        case '*'
            for f in $fx ; xdg-open $f > /dev/null 2> /dev/null ; end
    end
}}

# Archive bindings
cmd unarchive ${{
    switch "$f"
        case '*.zip'
            unzip "$f"
        case '*.tar.gz'
            tar -xzvf "$f"
        case '*.tar.bz2'
            tar -xjvf "$f"
        case '*.tar'
            tar -xvf "$f"
        case '*'
            echo "Unsupported format"
    end
}}

cmd mkdir ${{
  printf "Directory Name: "
  read ans
  mkdir $ans
}}

cmd mkfile ${{
  printf "File Name: "
  read ans
  $EDITOR $ans
}}

map md mkdir
map mf mkfile
map <f2> rename

cmd fzf_jump ${{
    set res (fd . -H -i -d 3 | fzf --reverse --header='Jump to location')
    if [ -f $res ]
        set cmd select
    else if [ -d $res ]
        set cmd cd
    end
    lf -remote "send $id $cmd \"$res\""
}}

map f fzf_jump
map DD delete
